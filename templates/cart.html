{% extends "base.html" %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <h1>Shopping Cart</h1>
    
    {% if cart_items %}
    <div class="cart-items">
        {% for cart_data in cart_items %}
        <div class="cart-item" style="background-color: #1a1a1a; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid #333;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="flex-grow: 1;">
                    <h4>{{ cart_data.item.product.title }}</h4>
                    <p style="color: #aaa; margin-bottom: 0.5rem;">{{ cart_data.item.product.description[:100] }}...</p>
                    <div class="price-info">
                        <span class="usd-price">${{ "%.2f"|format(cart_data.item.product.price_usd) }} USD each</span>
                        <div class="crypto-prices" style="margin-top: 0.5rem;">
                            <div class="crypto-price">
                                <span class="amount">{{ "%.6f"|format(cart_data.crypto_amounts.BTC) }}</span> BTC
                            </div>
                            <div class="crypto-price">
                                <span class="amount">{{ "%.4f"|format(cart_data.crypto_amounts.ETH) }}</span> ETH
                            </div>
                            <div class="crypto-price">
                                <span class="amount">{{ "%.2f"|format(cart_data.crypto_amounts.SOL) }}</span> SOL
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 0 1rem;">
                    <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem;">
                        Quantity: {{ cart_data.item.quantity }}
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <form method="POST" action="{{ url_for('update_cart_item', item_id=cart_data.item.id) }}" style="display: inline;">
                            <button type="submit" name="action" value="decrease" class="btn btn-secondary" {% if cart_data.item.quantity <= 1 %}disabled{% endif %}>-</button>
                        </form>
                        <form method="POST" action="{{ url_for('update_cart_item', item_id=cart_data.item.id) }}" style="display: inline;">
                            <button type="submit" name="action" value="increase" class="btn btn-secondary">+</button>
                        </form>
                    </div>
                </div>
                
                <div style="text-align: right;">
                    <div class="item-total" style="font-size: 1.3rem; color: #00ff88; font-weight: bold; margin-bottom: 0.5rem;">
                        ${{ "%.2f"|format(cart_data.product_total) }} USD
                    </div>
                    <form method="POST" action="{{ url_for('update_cart_item', item_id=cart_data.item.id) }}" style="display: inline;">
                        <button type="submit" name="action" value="remove" class="delete-btn">Remove</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div class="cart-totals" style="background-color: #2a2a2a; padding: 2rem; border-radius: 8px; margin: 2rem 0; border: 1px solid #00ff88;">
        <h3>Order Summary</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0;">
            <div>
                <h4>Total USD: ${{ "%.2f"|format(total_usd) }}</h4>
                <div class="crypto-totals" style="margin-top: 1rem;">
                    <h5>Cryptocurrency Totals:</h5>
                    <div class="crypto-price">
                        <span class="amount">{{ "%.6f"|format(crypto_totals.BTC) }}</span> BTC
                    </div>
                    <div class="crypto-price">
                        <span class="amount">{{ "%.4f"|format(crypto_totals.ETH) }}</span> ETH
                    </div>
                    <div class="crypto-price">
                        <span class="amount">{{ "%.2f"|format(crypto_totals.SOL) }}</span> SOL
                    </div>
                </div>
            </div>
            
            <div>
                <form method="POST" action="{{ url_for('checkout_cart') }}">
                    <div class="form-group">
                        <label for="crypto_type">Select Cryptocurrency:</label>
                        <select class="form-control" id="crypto_type" name="crypto_type" required>
                            <option value="BTC">Bitcoin (BTC) - {{ "%.6f"|format(crypto_totals.BTC) }} BTC</option>
                            <option value="ETH">Ethereum (ETH) - {{ "%.4f"|format(crypto_totals.ETH) }} ETH</option>
                            <option value="SOL">Solana (SOL) - {{ "%.2f"|format(crypto_totals.SOL) }} SOL</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="delivery_location">Delivery Instructions:</label>
                        <textarea class="form-control" id="delivery_location" name="delivery_location" 
                                 rows="3" placeholder="Describe where you want the package delivered..." required></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button type="submit" class="btn">Checkout Now</button>
                        <form method="POST" action="{{ url_for('clear_cart') }}" style="display: inline;">
                            <button type="submit" class="btn btn-secondary">Clear Cart</button>
                        </form>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    {% else %}
    <div style="text-align: center; padding: 4rem;">
        <h3>Your cart is empty</h3>
        <p>Add some products to get started!</p>
        <a href="{{ url_for('index') }}" class="btn">Browse Products</a>
    </div>
    {% endif %}
</div>
{% endblock %}