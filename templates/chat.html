{% extends "base.html" %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <h1>ğŸ’¬ Chat with Admin</h1>
    
    <div class="chat-container" style="background-color: #1a1a1a; border-radius: 12px; border: 1px solid #333; overflow: hidden;">
        <div class="chat-messages" id="chatMessages" style="height: 500px; overflow-y: auto; padding: 1.5rem;">
            {% for message in messages %}
            <div class="message {% if message.is_admin_reply %}admin-message{% else %}user-message{% endif %}" 
                 style="margin-bottom: 1rem; padding: 1rem; border-radius: 8px; max-width: 70%; {% if message.is_admin_reply %}margin-left: auto; background-color: #2a2a2a; border: 1px solid #00ff88;{% else %}background-color: #333; border: 1px solid #555;{% endif %}">
                <div class="message-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <strong>{% if message.is_admin_reply %}Admin{% else %}You{% endif %}</strong>
                    <small style="color: #888;">{{ message.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                </div>
                <div class="message-content" style="white-space: pre-line;">{{ message.message }}</div>
            </div>
            {% endfor %}
        </div>
        
        <div class="chat-input" style="padding: 1.5rem; border-top: 1px solid #333;">
            <form method="POST" id="chatForm">
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" name="message" class="form-control" placeholder="Type your message to admin..." required 
                           style="flex-grow: 1;" id="messageInput">
                    <button type="submit" class="btn">Send</button>
                </div>
            </form>
        </div>
    </div>
    
    <div style="margin-top: 1rem; text-align: center;">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">â† Back to Home</a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const chatMessages = document.getElementById('chatMessages');
    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    // Auto-refresh messages every 5 seconds
    setInterval(function() {
        fetch('/chat/messages')
            .then(response => response.json())
            .then(data => {
                if (data.messages.length > {{ messages|length }}) {
                    location.reload();
                }
            });
    }, 5000);
});
</script>
{% endblock %}